{"version":3,"file":"taquito-beacon-wallet.es6.js","sources":["../src/version.ts","../src/taquito-beacon-wallet.ts"],"sourcesContent":["\n// IMPORTANT: THIS FILE IS AUTO GENERATED! DO NOT MANUALLY EDIT OR CHECKIN!\nexport const VERSION = {\n    \"commitHash\": \"6d90b3d5e616a6e9b9ad9dd8453b5068e7396fff\",\n    \"version\": \"13.0.1\"\n};\n","/**\n * @packageDocumentation\n * @module @taquito/beacon-wallet\n */\n\nimport {\n  DAppClient,\n  DAppClientOptions,\n  RequestPermissionInput,\n  PermissionScope,\n} from '@airgap/beacon-dapp';\n\nimport {\n  createOriginationOperation,\n  createSetDelegateOperation,\n  createTransferOperation,\n  WalletDelegateParams,\n  WalletOriginateParams,\n  WalletProvider,\n  WalletTransferParams,\n} from '@taquito/taquito';\n\nexport { VERSION } from './version';\n\n/**\n *  @category Error\n *  @description Error that indicates the Beacon wallet not being initialized\n */\nexport class BeaconWalletNotInitialized extends Error {\n  name = 'BeaconWalletNotInitialized';\n\n  constructor() {\n    super('You need to initialize BeaconWallet by calling beaconWallet.requestPermissions first');\n  }\n}\n\n/**\n *  @category Error\n *  @description Error that indicates missing required persmission scopes\n */\nexport class MissingRequiredScopes extends Error {\n  name = 'MissingRequiredScopes';\n\n  constructor(public requiredScopes: PermissionScope[]) {\n    super(`Required permissions scopes were not granted: ${requiredScopes.join(',')}`);\n  }\n}\n\nexport class BeaconWallet implements WalletProvider {\n  public client: DAppClient;\n\n  constructor(options: DAppClientOptions) {\n    this.client = new DAppClient(options);\n  }\n\n  private validateRequiredScopesOrFail(\n    permissionScopes: PermissionScope[],\n    requiredScopes: PermissionScope[]\n  ) {\n    const mandatoryScope = new Set(requiredScopes);\n\n    for (const scope of permissionScopes) {\n      if (mandatoryScope.has(scope)) {\n        mandatoryScope.delete(scope);\n      }\n    }\n\n    if (mandatoryScope.size > 0) {\n      throw new MissingRequiredScopes(Array.from(mandatoryScope));\n    }\n  }\n\n  async requestPermissions(request?: RequestPermissionInput) {\n    await this.client.requestPermissions(request);\n  }\n\n  async getPKH() {\n    const account = await this.client.getActiveAccount();\n    if (!account) {\n      throw new BeaconWalletNotInitialized();\n    }\n    return account.address;\n  }\n\n  async mapTransferParamsToWalletParams(params: () => Promise<WalletTransferParams>) {\n    let walletParams: WalletTransferParams;\n    await this.client.showPrepare();\n    try {\n      walletParams = await params();\n    } catch (err) {\n      await this.client.hideUI();\n      throw err;\n    }\n    return this.removeDefaultParams(\n      walletParams,\n      await createTransferOperation(this.formatParameters(walletParams))\n    );\n  }\n\n  async mapOriginateParamsToWalletParams(params: () => Promise<WalletOriginateParams>) {\n    let walletParams: WalletOriginateParams;\n    await this.client.showPrepare();\n    try {\n      walletParams = await params();\n    } catch (err) {\n      await this.client.hideUI();\n      throw err;\n    }\n    return this.removeDefaultParams(\n      walletParams,\n      await createOriginationOperation(this.formatParameters(walletParams))\n    );\n  }\n\n  async mapDelegateParamsToWalletParams(params: () => Promise<WalletDelegateParams>) {\n    let walletParams: WalletDelegateParams;\n    await this.client.showPrepare();\n    try {\n      walletParams = await params();\n    } catch (err) {\n      await this.client.hideUI();\n      throw err;\n    }\n    return this.removeDefaultParams(\n      walletParams,\n      await createSetDelegateOperation(this.formatParameters(walletParams))\n    );\n  }\n\n  formatParameters(params: any) {\n    if (params.fee) {\n      params.fee = params.fee.toString();\n    }\n    if (params.storageLimit) {\n      params.storageLimit = params.storageLimit.toString();\n    }\n    if (params.gasLimit) {\n      params.gasLimit = params.gasLimit.toString();\n    }\n    return params;\n  }\n\n  removeDefaultParams(\n    params: WalletTransferParams | WalletOriginateParams | WalletDelegateParams,\n    operatedParams: any\n  ) {\n    // If fee, storageLimit or gasLimit is undefined by user\n    // in case of beacon wallet, dont override it by\n    // defaults.\n    if (!params.fee) {\n      delete operatedParams.fee;\n    }\n    if (!params.storageLimit) {\n      delete operatedParams.storage_limit;\n    }\n    if (!params.gasLimit) {\n      delete operatedParams.gas_limit;\n    }\n    return operatedParams;\n  }\n\n  async sendOperations(params: any[]) {\n    const account = await this.client.getActiveAccount();\n    if (!account) {\n      throw new BeaconWalletNotInitialized();\n    }\n    const permissions = account.scopes;\n    this.validateRequiredScopesOrFail(permissions, [PermissionScope.OPERATION_REQUEST]);\n\n    const { transactionHash } = await this.client.requestOperation({ operationDetails: params });\n    return transactionHash;\n  }\n\n  /**\n   *\n   * @description Removes all beacon values from the storage. After using this method, this instance is no longer usable.\n   * You will have to instanciate a new BeaconWallet.\n   */\n  async disconnect() {\n    await this.client.destroy();\n  }\n\n  /**\n   *\n   * @description This method removes the active account from local storage by setting it to undefined.\n   */\n  async clearActiveAccount() {\n    await this.client.setActiveAccount();\n  }\n}\n"],"names":[],"mappings":"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"}